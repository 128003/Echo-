<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upper Limb Ultrasound Report System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f8; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Navigation & Header */
        .nav-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .part-btn { margin: 5px; font-weight: 600; min-width: 100px; }
        .part-btn.active { background-color: #0d6efd; color: white; border-color: #0d6efd; }
        
        /* Content Sections */
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s; }
        
        .card-header-custom { background-color: #2c3e50; color: white; font-weight: bold; padding: 10px 15px; border-radius: 8px 8px 0 0; }
        .section-label { background-color: #e9ecef; color: #495057; padding: 8px 15px; font-weight: 700; border-left: 5px solid #0d6efd; margin-top: 15px; margin-bottom: 10px; }
        
        /* Finding Rows */
        .finding-row { padding: 12px 15px; border-bottom: 1px solid #eee; background: white; }
        .structure-label { font-weight: 700; color: #0d6efd; display: block; margin-bottom: 5px; font-size: 1.05rem; }
        
        /* Sub-options Styles */
        .sub-options { display: none; margin-left: 20px; padding: 10px; background-color: #f1f3f5; border-left: 3px solid #adb5bd; margin-top: 8px; border-radius: 4px; }
        .imp-sub-options { display: none; margin-left: 25px; padding: 5px 10px; border-left: 2px solid #198754; margin-top: 5px; }

        /* Report Box */
        .report-box { background: #fff; border: 2px solid #2c3e50; padding: 20px; min-height: 200px; white-space: pre-wrap; font-family: 'Courier New', Courier, monospace; font-size: 0.95rem; line-height: 1.5; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h3 class="text-center mb-4 fw-bold text-dark">Musculoskeletal Ultrasound Report</h3>

    <div class="nav-card">
        <div class="row align-items-center mb-3">
            <div class="col-md-2 fw-bold fs-5">Side:</div>
            <div class="col-md-10">
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="side" id="sideR" value="Right" checked>
                    <label class="btn btn-outline-primary" for="sideR">Right</label>

                    <input type="radio" class="btn-check" name="side" id="sideL" value="Left">
                    <label class="btn btn-outline-primary" for="sideL">Left</label>
                </div>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-md-2 fw-bold fs-5">Region:</div>
            <div class="col-md-10">
                <button class="btn btn-outline-secondary part-btn active" onclick="switchPart('shoulder')">Shoulder</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('elbow')">Elbow</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('wrist')">Wrist</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('knee')">Knee</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('ankle')">Ankle</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('mass')">Mass</button>
            </div>
        </div>
    </div>

    <div id="section_shoulder" class="content-section active">
        <div class="card shadow-sm mb-3">
            <div class="card-header-custom">I. Shoulder Findings</div>
            <div class="card-body p-0">
                
                <div class="finding-row">
                    <span class="structure-label">Biceps brachialis long head</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="peritendinous effusion (target sign)"> Target sign/peritendinous effusion</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypervascularity"> Hypervascularity</label>
                    <div class="d-inline-block">
                        <label class="me-3"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_bic_tear"> Tear</label>
                        <div id="sub_bic_tear" class="sub-options d-inline-block">
                            <label class="me-2"><input type="radio" name="bic_tear" value="partial thickness tear" checked> Partial</label>
                            <label class="me-2"><input type="radio" name="bic_tear" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>

                <div class="finding-row">
                    <span class="structure-label">AC Joint</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="OA change"> OA change</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="buldging (>3mm)"> Buldging (>3mm)</label>
                </div>

                <div class="finding-row">
                    <span class="structure-label">Subscapularis</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="poorly visible due to limited external rotation"> Poorly visible</label>
                    
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_subscap_tear"> Tear</label>
                        <div id="sub_subscap_tear" class="sub-options d-inline-block">
                            <label class="me-2"><input type="radio" name="subscap_tear" value="partial thickness tear" checked> Partial</label>
                            <label class="me-2"><input type="radio" name="subscap_tear" value="full thickness tear"> Full</label>
                            <label class="me-2"><input type="radio" name="subscap_tear" value="complete tear"> Complete</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>

                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_subscap_calc"> Calcific deposit</label>
                        <div id="sub_subscap_calc" class="sub-options d-inline-block">
                            <span class="text-muted small">Type: </span>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="arc-shape"> Arc-shape</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="fragmented"> Fragmented</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="nodular"> Nodular</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="cystic"> Cystic</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="milky"> Milky</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                </div>

                <div class="finding-row">
                    <span class="structure-label">Supraspinatus</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased thickness (>8mm)"> Increased thickness (>8mm)</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_supra_tear"> Tear</label>
                        <div id="sub_supra_tear" class="sub-options">
                            <div class="mb-1">
                                <span class="text-muted small">Type: </span>
                                <label class="me-2"><input type="checkbox" class="val-sub" value="bursal side"> Bursal</label>
                                <label class="me-2"><input type="checkbox" class="val-sub" value="articular side"> Articular</label>
                                <label class="me-2"><input type="checkbox" class="val-sub" value="intrasubstance"> Intrasubstance</label>
                                <label class="me-2"><input type="checkbox" class="val-sub" value="full-thickness"> Full-thickness</label>
                                <label class="me-2"><input type="checkbox" class="val-sub" value="complete tear"> Complete</label>
                            </div>
                            <div class="mb-1">
                                <span class="text-muted small">Features: </span>
                                <label class="me-2"><input type="checkbox" class="val-sub-feat" value="interface sign"> Interface sign</label>
                                <label class="me-2"><input type="checkbox" class="val-sub-feat" value="loss tendon volume/deltoid herniation"> Deltoid herniation</label>
                                <label class="me-2"><input type="checkbox" class="val-sub-feat" value="empty head with muscle retraction"> Empty head/Retraction</label>
                                <label class="me-2"><input type="checkbox" class="val-sub-feat" value="hypervascularity"> Hypervascularity</label>
                            </div>
                            <div>
                                <span class="text-muted small">Location: </span>
                                <label class="me-2"><input type="checkbox" class="val-sub-loc" value="distal"> Distal</label>
                                <label class="me-2"><input type="checkbox" class="val-sub-loc" value="proximal"> Proximal</label>
                                <label class="me-2"><input type="checkbox" class="val-sub-loc" value="anterior"> Anterior</label>
                                <label class="me-2"><input type="checkbox" class="val-sub-loc" value="posterior"> Posterior</label>
                            </div>
                        </div>
                    </div>

                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_supra_calc"> Calcific deposit</label>
                        <div id="sub_supra_calc" class="sub-options d-inline-block">
                            <label class="me-2"><input type="checkbox" class="val-sub" value="arc-shape"> Arc-shape</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="fragmented"> Fragmented</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="nodular"> Nodular</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="cystic"> Cystic</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="milky"> Milky</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                </div>

                <div class="finding-row">
                    <span class="structure-label">Subdeltoid bursa</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased thickness (>2mm)"> Increased thickness (>2mm)</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="fluid accumulation"> Fluid accumulation</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypervascularity"> Hypervascularity</label>
                </div>

                <div class="finding-row">
                    <span class="structure-label">Infraspinatus</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_infra_tear"> Tear</label>
                        <div id="sub_infra_tear" class="sub-options d-inline-block">
                            <label class="me-2"><input type="radio" name="infra_tear" value="partial thickness tear" checked> Partial</label>
                            <label class="me-2"><input type="radio" name="infra_tear" value="full thickness tear"> Full</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>

                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_infra_calc"> Calcific deposit</label>
                        <div id="sub_infra_calc" class="sub-options d-inline-block">
                            <label class="me-2"><input type="checkbox" class="val-sub" value="arc-shape"> Arc-shape</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="fragmented"> Fragmented</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="nodular"> Nodular</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="cystic"> Cystic</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="milky"> Milky</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                </div>

                <div class="finding-row">
                    <span class="structure-label">Posterior Labrum</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact (Normal)</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="fluid accumulation"> Fluid accumulation</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased synovial substance during the dynamic study"> Increased synovial substance (Dynamic)</label>
                </div>

                <div class="finding-row">
                    <span class="structure-label">Others</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="irregularity of greater tubercle of humeral head"> Irregularity of GT</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased thickness of IGHL (>4mm)"> IGHL > 4mm</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="trivial depression of humeral head and impingement of subdeltoid bursa during the dynamic study"> Dynamic Impingement of subdeltoid bursa</label>
                    <div class="mt-2">
                         <input type="text" class="form-control" id="sh_other_text" placeholder="Free text input...">
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-success">
            <div class="card-header-custom bg-success">II. Shoulder Impression</div>
            <div class="card-body">
                
                <div class="mb-2">
                    <label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_bic"> Biceps brachialis long head</label>
                    <div id="imp_sub_bic" class="imp-sub-options">
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tenosynovitis"> Tenosynovitis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="partial tear"> Partial Tear</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete Tear</label>
                    </div>
                </div>

                <div class="mb-2">
                    <label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_supra"> Supraspinatus</label>
                    <div id="imp_sub_supra" class="imp-sub-options">
                        <div class="mb-1">
                            <strong>Pathology: </strong>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendonitis"> Calcific Tendonitis</label>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendinosis"> Calcific Tendinosis</label>
                        </div>
                        <div>
                            <strong>Tear: </strong>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="partial thickness tear"> Partial</label>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="full thickness tear"> Full</label>
                            <label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete</label>
                            <span class="text-muted ms-2">Details: </span>
                            <label class="me-1"><input type="checkbox" class="imp-val-detail" value="distal"> Distal</label>
                            <label class="me-1"><input type="checkbox" class="imp-val-detail" value="proximal"> Proximal</label>
                            <label class="me-1"><input type="checkbox" class="imp-val-detail" value="bursal side"> Bursal</label>
                            <label class="me-1"><input type="checkbox" class="imp-val-detail" value="articular side"> Articular</label>
                            <label class="me-1"><input type="checkbox" class="imp-val-detail" value="intrasubstance"> Intrasubstance</label>
                        </div>
                    </div>
                </div>

                <div class="mb-2">
                    <label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_subscap"> Subscapularis</label>
                    <div id="imp_sub_subscap" class="imp-sub-options">
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendonitis"> Calcific Tendonitis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendinosis"> Calcific Tendinosis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="partial thickness tear"> Partial Tear</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="full thickness tear"> Full Tear</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete Tear</label>
                    </div>
                </div>

                <div class="mb-2">
                    <label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_infra"> Infraspinatus</label>
                    <div id="imp_sub_infra" class="imp-sub-options">
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendonitis"> Calcific Tendonitis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendinosis"> Calcific Tendinosis</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="partial thickness tear"> Partial Tear</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="full thickness tear"> Full Tear</label>
                        <label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete Tear</label>
                    </div>
                </div>

                <div class="mb-2">
                     <label class="fw-bold"><input type="checkbox" class="imp-check" value="Subacromial-subdeltoid bursopathy/bursitis"> Subacromial-subdeltoid bursopathy/bursitis</label>
                </div>
                <div class="mb-2">
                     <label class="fw-bold"><input type="checkbox" class="imp-check" value="Frozen shoulder was compatible"> Frozen shoulder was compatible</label>
                </div>
                
                <div class="mt-2">
                    <label class="fw-bold">Others:</label>
                    <input type="text" class="form-control" id="imp_other_text" placeholder="Other diagnosis...">
                </div>
            </div>
        </div>
    </div>

    <div id="section_elbow" class="content-section">
        <div class="card shadow-sm">
            <div class="card-header-custom">I. Elbow Findings</div>
            <div class="card-body p-0">
                <div class="section-label">Lateral Elbow</div>
                <div class="finding-row">
                    <span class="structure-label">Common wrist extensor tendon</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypervascularity"> Hypervascularity</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Traction spur"> Traction spur</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Calcification"> Calcification</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Cortical irregularity"> Cortical irregularity</label>
                    <div class="d-inline-block">
                        <label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_lat_cwet_tear"> Tear</label>
                        <div id="elb_lat_cwet_tear" class="sub-options d-inline-block">
                            <label class="me-1"><input type="radio" name="elb_lat_cwet" value="partial thickness tear" checked> Partial</label>
                            <label class="me-1"><input type="radio" name="elb_lat_cwet" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Humeroradial joint</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Effusion"> Effusion</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Synovial hypertrophy"> Synovial hypertrophy</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Cortical irregularity of radial head"> Cortical irregularity</label>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Radial collateral ligament</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <div class="d-inline-block">
                        <label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_lat_rcl_tear"> Tear</label>
                        <div id="elb_lat_rcl_tear" class="sub-options d-inline-block">
                            <label class="me-1"><input type="radio" name="elb_lat_rcl" value="partial thickness tear" checked> Partial</label>
                            <label class="me-1"><input type="radio" name="elb_lat_rcl" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>

                <div class="section-label">Anterior Elbow</div>
                <div class="finding-row">
                    <span class="structure-label">Anterior joint recess</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Effusion"> Effusion</label>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Distal biceps tendon</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenicity"> Hypoechogenicity</label>
                    <div class="d-inline-block">
                        <label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_ant_bic_tear"> Tear</label>
                        <div id="elb_ant_bic_tear" class="sub-options d-inline-block">
                            <label class="me-1"><input type="radio" name="elb_ant_bic" value="partial thickness tear" checked> Partial</label>
                            <label class="me-1"><input type="radio" name="elb_ant_bic" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Nerves</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Median nerve Intact"> Median Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val toggle-input" data-target="elb_med_entrap"> Median Entrapment at:</label>
                    <input type="text" id="elb_med_entrap" class="form-control d-inline-block w-auto py-0" disabled placeholder="loc">
                    
                    <label class="me-2 ms-3"><input type="checkbox" class="form-check-input val" value="Radial nerve Intact"> Radial Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val toggle-input" data-target="elb_rad_entrap"> Radial Entrapment at:</label>
                    <input type="text" id="elb_rad_entrap" class="form-control d-inline-block w-auto py-0" disabled placeholder="loc">
                </div>

                <div class="section-label">Medial Elbow</div>
                <div class="finding-row">
                    <span class="structure-label">Common wrist flexor tendon</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypervascularity"> Hypervascularity</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Calcification"> Calcification</label>
                    <div class="d-inline-block">
                        <label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_med_cwft_tear"> Tear</label>
                        <div id="elb_med_cwft_tear" class="sub-options d-inline-block">
                            <label class="me-1"><input type="radio" name="elb_med_cwft" value="partial thickness tear" checked> Partial</label>
                            <label class="me-1"><input type="radio" name="elb_med_cwft" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Ulnar collateral ligament</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Thickened"> Thickened</label>
                    <div class="d-inline-block">
                        <label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_med_ucl_tear"> Tear</label>
                        <div id="elb_med_ucl_tear" class="sub-options d-inline-block">
                            <label class="me-1"><input type="radio" name="elb_med_ucl" value="partial thickness tear" checked> Partial</label>
                            <label class="me-1"><input type="radio" name="elb_med_ucl" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>

                <div class="section-label">Posterior Elbow</div>
                <div class="finding-row">
                    <span class="structure-label">Triceps tendon</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Calcification"> Calcification</label>
                    <div class="d-inline-block">
                        <label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_post_tri_tear"> Tear</label>
                        <div id="elb_post_tri_tear" class="sub-options d-inline-block">
                            <label class="me-1"><input type="radio" name="elb_post_tri" value="partial thickness tear" checked> Partial</label>
                            <label class="me-1"><input type="radio" name="elb_post_tri" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Olecranon bursa</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Invisible"> Invisible</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Effusion"> Effusion</label>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Ulnar nerve</span>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Intact"> Intact</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label>
                    <label class="me-2"><input type="checkbox" class="form-check-input val" value="Subluxation under dynamic study"> Subluxation</label>
                    <div class="d-inline-block bg-light p-1 border rounded">
                        <label class="me-1 small fw-bold"><input type="checkbox" class="form-check-input val toggle-input" data-target="elb_csa_grp"> CSA:</label>
                        <span id="elb_csa_grp" style="opacity: 0.5;">
                            R:<input type="number" id="csa_r" class="form-control d-inline-block w-auto py-0 px-1" disabled style="width:50px!important"> 
                            L:<input type="number" id="csa_l" class="form-control d-inline-block w-auto py-0 px-1" disabled style="width:50px!important"> mm²
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="section_wrist" class="content-section"><div class="alert alert-secondary">Wrist section placeholder.</div></div>
    <div id="section_knee" class="content-section"><div class="alert alert-secondary">Knee section placeholder.</div></div>
    <div id="section_ankle" class="content-section"><div class="alert alert-secondary">Ankle section placeholder.</div></div>
    <div id="section_mass" class="content-section"><div class="alert alert-secondary">Mass section placeholder.</div></div>


    <button class="btn btn-primary w-100 py-3 mt-4 fw-bold fs-5" onclick="generateReport()">Generate Report</button>
    
    <div class="mt-4">
        <h5>Report Preview:</h5>
        <div id="output" class="report-box shadow-sm"></div>
    </div>
</div>

<script>
    // --- UI Logic ---
    function switchPart(partId) {
        document.querySelectorAll('.part-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
        document.getElementById('section_' + partId).classList.add('active');
    }

    document.querySelectorAll('.toggle-sub').forEach(cb => {
        cb.addEventListener('change', function() {
            const target = document.getElementById(this.dataset.target);
            if(target) target.style.display = this.checked ? 'inline-block' : 'none';
        });
    });

    document.querySelectorAll('.toggle-input').forEach(cb => {
        cb.addEventListener('change', function() {
            const target = document.getElementById(this.dataset.target);
            if(target) {
                if(this.dataset.target.includes('grp')) {
                    target.style.opacity = this.checked ? '1' : '0.5';
                    target.querySelectorAll('input').forEach(i => i.disabled = !this.checked);
                } else {
                    target.disabled = !this.checked;
                    if(!this.checked) target.value = '';
                }
            }
        });
    });

    // Auto-uncheck Logic for "Intact"
    document.querySelectorAll('.struct-intact').forEach(intact => {
        intact.addEventListener('change', function() {
            if(this.checked) {
                // Uncheck all other inputs in the same row
                let row = this.closest('.finding-row');
                row.querySelectorAll('input[type="checkbox"]:not(.struct-intact)').forEach(cb => {
                    cb.checked = false;
                    cb.dispatchEvent(new Event('change')); // Trigger toggle logic
                });
            }
        });
    });
    
    // Reverse Logic: If abnormal checked, uncheck Intact
    document.querySelectorAll('.finding-row input[type="checkbox"]:not(.struct-intact)').forEach(abnormal => {
        abnormal.addEventListener('change', function() {
            if(this.checked) {
                let row = this.closest('.finding-row');
                let intact = row.querySelector('.struct-intact');
                if(intact) intact.checked = false;
            }
        });
    });

    // --- Generation Logic ---
    function generateReport() {
        const side = document.querySelector('input[name="side"]:checked').value;
        const activePart = document.querySelector('.content-section.active').id;
        
        if (activePart === 'section_shoulder') {
            let findings = generateShoulderFindings();
            let impression = generateShoulderImpression(side);
            document.getElementById('output').innerText = findings + "\n" + impression;
        } else if (activePart === 'section_elbow') {
            document.getElementById('output').innerText = generateElbowFindings(side);
        } else {
            document.getElementById('output').innerText = `[${activePart}] Report under construction.`;
        }
    }

    function generateShoulderFindings() {
        let text = "";
        const container = document.getElementById('section_shoulder');
        
        // Smart "All Intact" Check
        const intactIds = container.querySelectorAll('.struct-intact:checked');
        const anyPathology = container.querySelectorAll('.val:checked').length > 0;
        // Biceps, AC, Subscap, Supra, Infra, Labrum = 6
        if (intactIds.length === 6 && !anyPathology) {
             return `Findings:\nintact biceps LH tendon, AC joint, subscapularis, supraspinatus tendon, infraspinatus and posterior labrum\n`;
        }

        let findingsList = [];

        container.querySelectorAll('.finding-row').forEach(row => {
            const label = row.querySelector('.structure-label').innerText;
            let rowVals = [];

            if (row.querySelector('.struct-intact') && row.querySelector('.struct-intact').checked) {
                rowVals.push("intact");
            }

            row.querySelectorAll('.val:checked').forEach(cb => {
                if(cb.classList.contains('toggle-sub') || cb.classList.contains('toggle-input')) return;
                rowVals.push(cb.value);
            });

            // Specific Sub-Logics
            // Biceps Tear
            if (row.querySelector('[data-target="sub_bic_tear"]:checked')) {
                let tearType = document.querySelector('input[name="bic_tear"]:checked').value;
                rowVals.push("tear (" + tearType + ")");
            }

            // Subscapularis Tear
            if (row.querySelector('[data-target="sub_subscap_tear"]:checked')) {
                let tearType = document.querySelector('input[name="subscap_tear"]:checked').value;
                let extra = document.querySelector('#sub_subscap_tear .val-sub-extra:checked');
                if(extra) tearType += ", Hypervascularity";
                rowVals.push("tear (" + tearType + ")");
            }
            // Subscapularis Calcific
            if (row.querySelector('[data-target="sub_subscap_calc"]:checked')) {
                let types = Array.from(document.querySelectorAll('#sub_subscap_calc .val-sub:checked')).map(c => c.value);
                let extra = document.querySelector('#sub_subscap_calc .val-sub-extra:checked');
                let desc = "calcific deposit along the subscapularis tendon fibers with partial shadowing";
                if(types.length > 0) desc += ` (${types.join(', ')})`;
                if(extra) desc += " with Hypervascularity";
                rowVals.push(desc);
            }

            // Supraspinatus Tear
            if (row.querySelector('[data-target="sub_supra_tear"]:checked')) {
                let subDiv = document.getElementById('sub_supra_tear');
                let types = Array.from(subDiv.querySelectorAll('.val-sub:checked')).map(c => c.value);
                let feats = Array.from(subDiv.querySelectorAll('.val-sub-feat:checked')).map(c => "with " + c.value);
                let locs = Array.from(subDiv.querySelectorAll('.val-sub-loc:checked')).map(c => c.value);
                
                let str = "tear";
                if(types.length > 0) str += ` (${types.join(', ')})`;
                if(feats.length > 0) str += ` ${feats.join(', ')}`;
                if(locs.length > 0) str += ` at ${locs.join('/')} part`;
                rowVals.push(str);
            }
            // Supraspinatus Calcific
            if (row.querySelector('[data-target="sub_supra_calc"]:checked')) {
                let types = Array.from(document.querySelectorAll('#sub_supra_calc .val-sub:checked')).map(c => c.value);
                let extra = document.querySelector('#sub_supra_calc .val-sub-extra:checked');
                let desc = "calcific deposit along the supraspinatus tendon fibers with partial shadowing";
                if(types.length > 0) desc += ` (${types.join(', ')})`;
                if(extra) desc += " with Hypervascularity";
                rowVals.push(desc);
            }

            // Infraspinatus Tear
            if (row.querySelector('[data-target="sub_infra_tear"]:checked')) {
                let tearType = document.querySelector('input[name="infra_tear"]:checked').value;
                let extra = document.querySelector('#sub_infra_tear .val-sub-extra:checked');
                if(extra) tearType += ", Hypervascularity";
                rowVals.push("tear (" + tearType + ")");
            }
            // Infraspinatus Calcific
            if (row.querySelector('[data-target="sub_infra_calc"]:checked')) {
                let types = Array.from(document.querySelectorAll('#sub_infra_calc .val-sub:checked')).map(c => c.value);
                let extra = document.querySelector('#sub_infra_calc .val-sub-extra:checked');
                let desc = "calcific deposit along the infraspinatus tendon fibers with partial shadowing";
                if(types.length > 0) desc += ` (${types.join(', ')})`;
                if(extra) desc += " with Hypervascularity";
                rowVals.push(desc);
            }

            // Others text
            if(label === "Others") {
                 let freeText = document.getElementById('sh_other_text').value;
                 if(freeText) rowVals.push(freeText);
            }

            if(rowVals.length > 0) {
                findingsList.push(`${label}: ${rowVals.join(', ')}`);
            }
        });

        if(findingsList.length > 0) {
            text += "Findings:\n" + findingsList.join('\n') + "\n";
        }
        return text;
    }

    function generateShoulderImpression(side) {
        let imps = [];
        
        // Biceps
        if (document.querySelector('[data-target="imp_sub_bic"]:checked')) {
            let details = Array.from(document.querySelectorAll('#imp_sub_bic .imp-val:checked')).map(c => c.value);
            if(details.length > 0) imps.push(`${side} Biceps brachialis long head: ${details.join(', ')}`);
        }

        // Supraspinatus
        if (document.querySelector('[data-target="imp_sub_supra"]:checked')) {
            let vals = Array.from(document.querySelectorAll('#imp_sub_supra .imp-val:checked')).map(c => c.value);
            let details = Array.from(document.querySelectorAll('#imp_sub_supra .imp-val-detail:checked')).map(c => c.value);
            let str = `${side} Supraspinatus: ${vals.join(', ')}`;
            if(details.length > 0) str += ` (${details.join(', ')})`;
            if(vals.length > 0) imps.push(str);
        }

        // Subscapularis
        if (document.querySelector('[data-target="imp_sub_subscap"]:checked')) {
            let vals = Array.from(document.querySelectorAll('#imp_sub_subscap .imp-val:checked')).map(c => c.value);
            if(vals.length > 0) imps.push(`${side} Subscapularis: ${vals.join(', ')}`);
        }

        // Infraspinatus
        if (document.querySelector('[data-target="imp_sub_infra"]:checked')) {
            let vals = Array.from(document.querySelectorAll('#imp_sub_infra .imp-val:checked')).map(c => c.value);
            if(vals.length > 0) imps.push(`${side} Infraspinatus: ${vals.join(', ')}`);
        }

        // Standard checkboxes
        document.querySelectorAll('.imp-check:checked').forEach(cb => {
            imps.push(`${side} ${cb.value}`);
        });

        // Other Text
        let otherImp = document.getElementById('imp_other_text').value;
        if(otherImp) imps.push(`${side} ${otherImp}`);

        if(imps.length === 0) return "";

        let text = `Impression:\nThis ultrasonography study of ${side} shoulder showed:\n`;
        imps.forEach(imp => text += `* ${imp}\n`);
        text += "Please correlate with clinical presentation.";
        return text;
    }

    function generateElbowFindings(side) {
        let text = `This ultrasonography study of ${side} elbow showed:\nFindings:\n`;
        const container = document.getElementById('section_elbow');
        
        container.querySelectorAll('.finding-row').forEach(row => {
            const label = row.querySelector('.structure-label').innerText;
            let rowVals = [];

            row.querySelectorAll('.val:checked').forEach(cb => {
                if(cb.classList.contains('toggle-sub') || cb.classList.contains('toggle-input')) return;
                rowVals.push(cb.value);
            });

            // Radio Buttons
            if (row.querySelector('.toggle-sub:checked') && row.querySelector('input[type="radio"]')) {
                rowVals.push("tear (" + row.querySelector('input[type="radio"]:checked').value + ")");
            }

            // Entrapment
            if (row.querySelector('.toggle-input:checked') && row.querySelector('input[type="text"]')) {
                rowVals.push(`Entrapment at ${row.querySelector('input[type="text"]').value || '?'}`);
            }

            // CSA
            if (row.querySelector('.toggle-input:checked') && row.querySelector('#csa_r')) {
                let r = document.getElementById('csa_r').value || '-';
                let l = document.getElementById('csa_l').value || '-';
                rowVals.push(`CSA at cubital tunnel (R: ${r}, L: ${l} mm²)`);
            }

            if(rowVals.length > 0) {
                text += `- ${label}: ${rowVals.join(', ')}\n`;
            }
        });
        
        text += "Please correlate with clinical presentation.";
        return text;
    }
</script>

</body>
</html>
