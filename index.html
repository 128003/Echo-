<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Elbow Echo Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; padding: 20px; font-family: 'Segoe UI', Arial, sans-serif; }
        .card { margin-bottom: 20px; border-radius: 12px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .section-header { background-color: #0d6efd; color: white; padding: 12px 20px; border-radius: 12px 12px 0 0; font-weight: bold; }
        .structure-group { padding: 15px 20px; border-bottom: 1px solid #edf0f2; }
        .structure-name { font-weight: 600; color: #2c3e50; margin-bottom: 8px; display: block; }
        .option-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .sub-options { margin-left: 25px; padding: 10px; border-left: 3px solid #0d6efd; background: #f8f9fa; margin-top: 8px; border-radius: 0 5px 5px 0; display: none; }
        .report-output { background: #fff; border: 2px solid #0d6efd; padding: 25px; white-space: pre-wrap; font-family: 'Consolas', 'Monaco', monospace; line-height: 1.6; }
        .impression-item { padding: 5px 10px; border-radius: 5px; transition: background 0.3s; }
        .suggested { background-color: #fff3cd; border: 1px dashed #ffc107; } /* 建議診斷的高亮樣式 */
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">復健科超音波檢查報告系統</h2>

    <div class="card p-3 shadow-sm">
        <div class="d-flex align-items-center">
            <span class="me-4 fw-bold">Select Side:</span>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="side" id="sideR" value="right" checked>
                <label class="form-check-label" for="sideR">Right Elbow</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="side" id="sideL" value="left">
                <label class="form-check-label" for="sideL">Left Elbow</label>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-header">第一部分：Lateral Elbow</div>
        <div class="structure-group" id="group_cwt">
            <span class="structure-name">Common wrist extensor tendon:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Hypoechogenic" data-suggest="imp_tennis,imp_cwt_path"> Hypoechogenic</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Hypervascularity" data-suggest="imp_tennis"> Hypervascularity</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding tear-trigger" value="Tear" data-target="sub_cwt" data-suggest="imp_cwt_tear"> Tear</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Traction spur"> Traction spur</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Calcification"> Calcification</label>
            </div>
            <div class="sub-options" id="sub_cwt">
                <label class="form-check-inline me-3"><input type="radio" name="cwt_tear" value="Partial thickness"> Partial</label>
                <label class="form-check-inline"><input type="radio" name="cwt_tear" value="Full thickness"> Full thickness</label>
            </div>
        </div>
        <div class="structure-group" id="group_hrj">
            <span class="structure-name">Humeroradial joint:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Effusion" data-suggest="imp_hr_arthritis"> Effusion</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Synovial hypertrophy" data-suggest="imp_hr_arthritis"> Synovial hypertrophy</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Cortical irregularity of radial head"> Cortical irregularity of radial head</label>
            </div>
        </div>
        <div class="structure-group" id="group_rcl">
            <span class="structure-name">Radial collateral ligament (RCL):</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding tear-trigger" value="Tear" data-target="sub_rcl" data-suggest="imp_rcl_sprain"> Tear</label>
            </div>
            <div class="sub-options" id="sub_rcl">
                <label class="form-check-inline me-3"><input type="radio" name="rcl_tear" value="Partial thickness"> Partial</label>
                <label class="form-check-inline"><input type="radio" name="rcl_tear" value="Full thickness"> Full thickness</label>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-header">第二部分：Anterior Elbow</div>
        <div class="structure-group" id="group_ajr">
            <span class="structure-name">Anterior joint recess:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Effusion"> Effusion</label>
            </div>
        </div>
        <div class="structure-group" id="group_median">
            <span class="structure-name">Median nerve:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding input-trigger" value="Entrapment" data-target="loc_median"> Entrapment at:</label>
                <input type="text" class="form-control form-control-sm w-50 d-none" id="loc_median">
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-header">第三部分：Medial Elbow</div>
        <div class="structure-group" id="group_cft">
            <span class="structure-name">Common wrist flexor tendon:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Hypoechogenic" data-suggest="imp_cft_path"> Hypoechogenic</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding tear-trigger" value="Tear" data-target="sub_cft"> Tear</label>
            </div>
            <div class="sub-options" id="sub_cft">
                <label class="form-check-inline"><input type="radio" name="cft_tear" value="Partial thickness"> Partial</label>
            </div>
        </div>
        <div class="structure-group" id="group_huj">
            <span class="structure-name">Humeroulnar joint:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Effusion"> Effusion</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Hypervascularity"> Hypervascularity</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Synovial hypertrophy"> Synovial hypertrophy</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Cortical irregularity of radial head"> Cortical irregularity of radial head</label>
            </div>
        </div>
        <div class="structure-group" id="group_ucl">
            <span class="structure-name">Ulnar collateral ligament (UCL):</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Intact"> Intact</label>
                <label class="form-check"><input type="checkbox" class="form-check-input finding tear-trigger" value="Tear" data-target="sub_ucl" data-suggest="imp_ucl_sprain"> Tear</label>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-header">第四部分：Posterior Elbow</div>
        <div class="structure-group" id="group_ulnar">
            <span class="structure-name">Ulnar nerve:</span>
            <div class="option-group">
                <label class="form-check"><input type="checkbox" class="form-check-input finding" value="Subluxation under dynamic study" data-suggest="imp_un_dislocation"> Subluxation under dynamic study</label>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-header" style="background-color: #198754;">第伍部分：Impression (Diagnoses)</div>
        <div class="p-3">
            <div class="row">
                <div class="col-md-6 impression-item" id="imp_tennis"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="lateral epicondylosis with common wrist extensor tendinitis/tendinosis, compatible with tennis elbow."> Tennis Elbow</label></div>
                <div class="col-md-6 impression-item" id="imp_hr_arthritis"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="humeroradial arthritis."> Humeroradial Arthritis</label></div>
                <div class="col-md-6 impression-item" id="imp_rcl_sprain"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="elbow radial collateral ligament sprain."> RCL Sprain</label></div>
                <div class="col-md-6 impression-item" id="imp_ucl_sprain"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="elbow ulnar collateral ligament sprain."> UCL Sprain</label></div>
                <div class="col-md-6 impression-item" id="imp_cwt_path"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="common wrist extensor tendinopathy."> CWT Tendinopathy</label></div>
                <div class="col-md-6 impression-item" id="imp_cwt_tear"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="common wrist extensor tendon partial tear."> CWT Partial Tear</label></div>
                <div class="col-md-6 impression-item" id="imp_un_dislocation"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="Ulnar nerve dynamic dislocation at cubital tunnel."> Ulnar Nerve Dislocation</label></div>
                <div class="col-md-6 impression-item" id="imp_cft_path"><label class="form-check"><input type="checkbox" class="form-check-input imp-check" value="common wrist flexor tendinopathy."> CFT Tendinopathy</label></div>
            </div>
        </div>
    </div>

    <button class="btn btn-success btn-lg w-100 mb-4 shadow" onclick="generateReport()">Generate Final Report</button>

    <div class="mb-5">
        <h5>Final Echography Report:</h5>
        <div id="output" class="report-output shadow-sm"></div>
        <button class="btn btn-primary mt-2" onclick="copyToClipboard()">Copy to Clipboard</button>
    </div>
</div>



<script>
// Smart Suggestion Logic
document.querySelectorAll('.finding').forEach(chk => {
    chk.addEventListener('change', function() {
        const suggestions = this.dataset.suggest ? this.dataset.suggest.split(',') : [];
        suggestions.forEach(impId => {
            const impBox = document.getElementById(impId);
            if (this.checked) {
                impBox.classList.add('suggested');
                // 可選：自動勾選建議項目
                // impBox.querySelector('input').checked = true;
            } else {
                impBox.classList.remove('suggested');
            }
        });
    });
});

// UI Toggles
document.querySelectorAll('.tear-trigger').forEach(chk => {
    chk.addEventListener('change', function() {
        document.getElementById(this.dataset.target).style.display = this.checked ? 'block' : 'none';
    });
});
document.querySelectorAll('.input-trigger').forEach(chk => {
    chk.addEventListener('change', function() {
        document.getElementById(this.dataset.target).classList.toggle('d-none', !this.checked);
    });
});

function generateReport() {
    const side = document.querySelector('input[name="side"]:checked').value;
    let report = `This ultrasonography study of ${side} elbow showed:\n\n`;

    const sections = [
        { label: "Lateral Elbow", ids: ["cwt", "hrj", "rcl"] },
        { label: "Anterior Elbow", ids: ["ajr", "median"] },
        { label: "Medial Elbow", ids: ["cft", "huj", "ucl"] },
        { label: "Posterior Elbow", ids: ["ulnar"] }
    ];

    sections.forEach(sec => {
        let secContent = "";
        sec.ids.forEach(id => {
            const group = document.getElementById('group_' + id);
            const checked = group.querySelectorAll('.finding:checked');
            if (checked.length > 0) {
                const name = group.querySelector('.structure-name').innerText.replace(':', '');
                let vals = Array.from(checked).map(cb => {
                    if (cb.value === 'Tear') {
                        const type = group.querySelector(`input[name="${id}_tear"]:checked`);
                        return type ? `${type.value} tear` : 'Tear';
                    }
                    if (cb.value === 'Entrapment') {
                        return `Entrapment at ${document.getElementById('loc_'+id).value}`;
                    }
                    return cb.value;
                });
                secContent += `- ${name}: ${vals.join(', ')}\n`;
            }
        });
        if (secContent) report += `[${sec.label}]\n${secContent}\n`;
    });

    // Impression Section
    const selectedImps = Array.from(document.querySelectorAll('.imp-check:checked')).map(cb => cb.value);
    if (selectedImps.length > 0) {
        report += `[Impression]\n`;
        selectedImps.forEach(imp => report += `* ${imp}\n`);
    }

    report += `\nPlease correlate with clinical presentation.`;
    document.getElementById('output').innerText = report;
}

function copyToClipboard() {
    navigator.clipboard.writeText(document.getElementById('output').innerText).then(() => alert('Copied!'));
}
</script>
</body>
</html>
