<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSK Ultrasound Report Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f8; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Navigation */
        .nav-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .part-btn { margin: 5px; font-weight: 600; min-width: 100px; }
        .part-btn.active { background-color: #0d6efd; color: white; border-color: #0d6efd; }
        
        /* Content Sections */
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s; }
        
        .card-header-custom { background-color: #2c3e50; color: white; font-weight: bold; padding: 10px 15px; border-radius: 8px 8px 0 0; }
        .section-label { background-color: #e9ecef; color: #495057; padding: 8px 15px; font-weight: 700; border-left: 5px solid #0d6efd; margin-top: 15px; margin-bottom: 10px; }
        
        /* Rows */
        .finding-row { padding: 12px 15px; border-bottom: 1px solid #eee; background: white; }
        .structure-label { font-weight: 700; color: #0d6efd; display: block; margin-bottom: 5px; font-size: 1.05rem; }
        
        /* Sub-options */
        .sub-options { display: none; margin-left: 20px; padding: 10px; background-color: #f1f3f5; border-left: 3px solid #adb5bd; margin-top: 8px; border-radius: 4px; }
        .imp-sub-options { display: none; margin-left: 25px; padding: 5px 10px; border-left: 2px solid #198754; margin-top: 5px; }

        /* Report Box */
        .report-box { background: #fff; border: 2px solid #2c3e50; padding: 20px; min-height: 200px; white-space: pre-wrap; font-family: 'Courier New', Courier, monospace; font-size: 0.95rem; line-height: 1.5; }

        .input-mini { width: 70px; display: inline-block; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h3 class="text-center mb-4 fw-bold text-dark">Musculoskeletal Ultrasound Report</h3>

    <div class="nav-card">
        <div class="row align-items-center mb-3">
            <div class="col-md-2 fw-bold fs-5">Side:</div>
            <div class="col-md-10">
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="side" id="sideR" value="Right" checked>
                    <label class="btn btn-outline-primary" for="sideR">Right</label>

                    <input type="radio" class="btn-check" name="side" id="sideL" value="Left">
                    <label class="btn btn-outline-primary" for="sideL">Left</label>
                </div>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-md-2 fw-bold fs-5">Region:</div>
            <div class="col-md-10">
                <button class="btn btn-outline-secondary part-btn active" onclick="switchPart('shoulder')">Shoulder</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('elbow')">Elbow</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('mass')">Mass</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('wrist')">Wrist</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('knee')">Knee</button>
                <button class="btn btn-outline-secondary part-btn" onclick="switchPart('ankle')">Ankle</button>
            </div>
        </div>
    </div>

    <div id="section_shoulder" class="content-section active">
        <div class="card shadow-sm mb-3">
            <div class="card-header-custom">I. Shoulder Findings</div>
            <div class="card-body p-0">
                <div class="finding-row">
                    <span class="structure-label">Biceps brachialis long head</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="peritendinous effusion (target sign)"> Target sign/peritendinous effusion</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypervascularity"> Hypervascularity</label>
                    <div class="d-inline-block">
                        <label class="me-3"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_bic_tear"> Tear</label>
                        <div id="sub_bic_tear" class="sub-options d-inline-block">
                            <label class="me-2"><input type="radio" name="bic_tear" value="partial thickness tear" checked> Partial</label>
                            <label class="me-2"><input type="radio" name="bic_tear" value="full thickness tear"> Full</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">AC Joint</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="OA change"> OA change</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="buldging (>3mm)"> Buldging (>3mm)</label>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Subscapularis</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="poorly visible due to limited external rotation"> Poorly visible</label>
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_subscap_tear"> Tear</label>
                        <div id="sub_subscap_tear" class="sub-options d-inline-block">
                            <label class="me-2"><input type="radio" name="subscap_tear" value="partial thickness tear" checked> Partial</label>
                            <label class="me-2"><input type="radio" name="subscap_tear" value="full thickness tear"> Full</label>
                            <label class="me-2"><input type="radio" name="subscap_tear" value="complete tear"> Complete</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_subscap_calc"> Calcific deposit</label>
                        <div id="sub_subscap_calc" class="sub-options d-inline-block">
                            <span class="text-muted small">Type: </span>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="arc-shape"> Arc-shape</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="fragmented"> Fragmented</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="nodular"> Nodular</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="cystic"> Cystic</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="milky"> Milky</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Supraspinatus</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased thickness (>8mm)"> Increased thickness (>8mm)</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_supra_tear"> Tear</label>
                        <div id="sub_supra_tear" class="sub-options">
                            <div class="mb-1"><span class="text-muted small">Type: </span><label class="me-2"><input type="checkbox" class="val-sub" value="bursal side"> Bursal</label><label class="me-2"><input type="checkbox" class="val-sub" value="articular side"> Articular</label><label class="me-2"><input type="checkbox" class="val-sub" value="intrasubstance"> Intrasubstance</label><label class="me-2"><input type="checkbox" class="val-sub" value="full-thickness"> Full-thickness</label><label class="me-2"><input type="checkbox" class="val-sub" value="complete tear"> Complete</label></div>
                            <div class="mb-1"><span class="text-muted small">Features: </span><label class="me-2"><input type="checkbox" class="val-sub-feat" value="interface sign"> Interface sign</label><label class="me-2"><input type="checkbox" class="val-sub-feat" value="loss tendon volume/deltoid herniation"> Deltoid herniation</label><label class="me-2"><input type="checkbox" class="val-sub-feat" value="empty head with muscle retraction"> Empty head/Retraction</label><label class="me-2"><input type="checkbox" class="val-sub-feat" value="hypervascularity"> Hypervascularity</label></div>
                            <div><span class="text-muted small">Location: </span><label class="me-2"><input type="checkbox" class="val-sub-loc" value="distal"> Distal</label><label class="me-2"><input type="checkbox" class="val-sub-loc" value="proximal"> Proximal</label><label class="me-2"><input type="checkbox" class="val-sub-loc" value="anterior"> Anterior</label><label class="me-2"><input type="checkbox" class="val-sub-loc" value="posterior"> Posterior</label></div>
                        </div>
                    </div>
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_supra_calc"> Calcific deposit</label>
                        <div id="sub_supra_calc" class="sub-options d-inline-block">
                            <label class="me-2"><input type="checkbox" class="val-sub" value="arc-shape"> Arc-shape</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="fragmented"> Fragmented</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="nodular"> Nodular</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="cystic"> Cystic</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="milky"> Milky</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Subdeltoid bursa</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased thickness (>2mm)"> Increased thickness (>2mm)</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="fluid accumulation"> Fluid accumulation</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypervascularity"> Hypervascularity</label>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Infraspinatus</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="hypoechoic and heterogenous change"> Hypoechoic/Heterogenous</label>
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_infra_tear"> Tear</label>
                        <div id="sub_infra_tear" class="sub-options d-inline-block">
                            <label class="me-2"><input type="radio" name="infra_tear" value="partial thickness tear" checked> Partial</label>
                            <label class="me-2"><input type="radio" name="infra_tear" value="full thickness tear"> Full</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                    <div class="d-block mt-1">
                        <label class="me-3 fw-bold"><input type="checkbox" class="form-check-input val toggle-sub" data-target="sub_infra_calc"> Calcific deposit</label>
                        <div id="sub_infra_calc" class="sub-options d-inline-block">
                            <label class="me-2"><input type="checkbox" class="val-sub" value="arc-shape"> Arc-shape</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="fragmented"> Fragmented</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="nodular"> Nodular</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="cystic"> Cystic</label>
                            <label class="me-2"><input type="checkbox" class="val-sub" value="milky"> Milky</label>
                            <label class="ms-2 border-start ps-2"><input type="checkbox" class="val-sub-extra" value="Hypervascularity"> Hypervascularity</label>
                        </div>
                    </div>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Posterior Labrum</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input struct-intact" value="intact"> Intact (Normal)</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="fluid accumulation"> Fluid accumulation</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased synovial substance during the dynamic study"> Increased synovial substance (Dynamic)</label>
                </div>
                <div class="finding-row">
                    <span class="structure-label">Others</span>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="irregularity of greater tubercle of humeral head"> Irregularity of GT</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="increased thickness of IGHL (>4mm)"> IGHL > 4mm</label>
                    <label class="me-3"><input type="checkbox" class="form-check-input val" value="trivial depression of humeral head and impingement of subdeltoid bursa during the dynamic study"> Dynamic Impingement of subdeltoid bursa</label>
                    <div class="mt-2"><input type="text" class="form-control" id="sh_other_text" placeholder="Free text input..."></div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-success">
            <div class="card-header-custom bg-success">II. Shoulder Impression</div>
            <div class="card-body">
                <div class="mb-2"><label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_bic"> Biceps brachialis long head</label><div id="imp_sub_bic" class="imp-sub-options"><label class="me-2"><input type="checkbox" class="imp-val" value="tenosynovitis"> Tenosynovitis</label><label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label><label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label><label class="me-2"><input type="checkbox" class="imp-val" value="partial tear"> Partial Tear</label><label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete Tear</label></div></div>
                <div class="mb-2"><label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_supra"> Supraspinatus</label><div id="imp_sub_supra" class="imp-sub-options"><div class="mb-1"><strong>Pathology: </strong><label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label><label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label><label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendonitis"> Calcific Tendonitis</label><label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendinosis"> Calcific Tendinosis</label></div><div><strong>Tear: </strong><label class="me-2"><input type="checkbox" class="imp-val" value="partial thickness tear"> Partial</label><label class="me-2"><input type="checkbox" class="imp-val" value="full thickness tear"> Full</label><label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete</label><span class="text-muted ms-2">Details: </span><label class="me-1"><input type="checkbox" class="imp-val-detail" value="distal"> Distal</label><label class="me-1"><input type="checkbox" class="imp-val-detail" value="proximal"> Proximal</label><label class="me-1"><input type="checkbox" class="imp-val-detail" value="bursal side"> Bursal</label><label class="me-1"><input type="checkbox" class="imp-val-detail" value="articular side"> Articular</label><label class="me-1"><input type="checkbox" class="imp-val-detail" value="intrasubstance"> Intrasubstance</label></div></div></div>
                <div class="mb-2"><label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_subscap"> Subscapularis</label><div id="imp_sub_subscap" class="imp-sub-options"><label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label><label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label><label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendonitis"> Calcific Tendonitis</label><label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendinosis"> Calcific Tendinosis</label><label class="me-2"><input type="checkbox" class="imp-val" value="partial thickness tear"> Partial Tear</label><label class="me-2"><input type="checkbox" class="imp-val" value="full thickness tear"> Full Tear</label><label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete Tear</label></div></div>
                <div class="mb-2"><label class="fw-bold"><input type="checkbox" class="toggle-sub" data-target="imp_sub_infra"> Infraspinatus</label><div id="imp_sub_infra" class="imp-sub-options"><label class="me-2"><input type="checkbox" class="imp-val" value="tendinopathy"> Tendinopathy</label><label class="me-2"><input type="checkbox" class="imp-val" value="tendinosis"> Tendinosis</label><label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendonitis"> Calcific Tendonitis</label><label class="me-2"><input type="checkbox" class="imp-val" value="calcific tendinosis"> Calcific Tendinosis</label><label class="me-2"><input type="checkbox" class="imp-val" value="partial thickness tear"> Partial Tear</label><label class="me-2"><input type="checkbox" class="imp-val" value="full thickness tear"> Full Tear</label><label class="me-2"><input type="checkbox" class="imp-val" value="complete tear"> Complete Tear</label></div></div>
                <div class="mb-2"><label class="fw-bold"><input type="checkbox" class="imp-check" value="Subacromial-subdeltoid bursopathy/bursitis"> Subacromial-subdeltoid bursopathy/bursitis</label></div>
                <div class="mb-2"><label class="fw-bold"><input type="checkbox" class="imp-check" value="Frozen shoulder was compatible"> Frozen shoulder was compatible</label></div>
                <div class="mt-2"><label class="fw-bold">Others:</label><input type="text" class="form-control" id="imp_other_text" placeholder="Other diagnosis..."></div>
            </div>
        </div>
    </div>

    <div id="section_elbow" class="content-section">
        <div class="card shadow-sm mb-3">
            <div class="card-header-custom">I. Elbow Findings</div>
            <div class="card-body p-0">
                <div class="section-label">Lateral Elbow</div>
                <div class="finding-row"><span class="structure-label">Common wrist extensor tendon</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypervascularity"> Hypervascularity</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Traction spur"> Traction spur</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Calcification"> Calcification</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Cortical irregularity"> Cortical irregularity</label><div class="d-inline-block"><label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_lat_cwet_tear"> Tear</label><div id="elb_lat_cwet_tear" class="sub-options d-inline-block"><label class="me-1"><input type="radio" name="elb_lat_cwet" value="partial thickness tear" checked> Partial</label><label class="me-1"><input type="radio" name="elb_lat_cwet" value="full thickness tear"> Full</label></div></div></div>
                <div class="finding-row"><span class="structure-label">Humeroradial joint</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Effusion"> Effusion</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Synovial hypertrophy"> Synovial hypertrophy</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Cortical irregularity of radial head"> Cortical irregularity</label></div>
                <div class="finding-row"><span class="structure-label">Radial collateral ligament</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><div class="d-inline-block"><label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_lat_rcl_tear"> Tear</label><div id="elb_lat_rcl_tear" class="sub-options d-inline-block"><label class="me-1"><input type="radio" name="elb_lat_rcl" value="partial thickness tear" checked> Partial</label><label class="me-1"><input type="radio" name="elb_lat_rcl" value="full thickness tear"> Full</label></div></div></div>
                <div class="finding-row bg-light"><input type="text" class="form-control" id="elb_lat_other" placeholder="Others (Lateral)..."></div>

                <div class="section-label">Anterior Elbow</div>
                <div class="finding-row"><span class="structure-label">Anterior joint recess</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Effusion"> Effusion</label></div>
                <div class="finding-row"><span class="structure-label">Distal biceps tendon</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenicity"> Hypoechogenicity</label><div class="d-inline-block"><label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_ant_bic_tear"> Tear</label><div id="elb_ant_bic_tear" class="sub-options d-inline-block"><label class="me-1"><input type="radio" name="elb_ant_bic" value="partial thickness tear" checked> Partial</label><label class="me-1"><input type="radio" name="elb_ant_bic" value="full thickness tear"> Full</label></div></div></div>
                <div class="finding-row"><span class="structure-label">Median Nerve</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val toggle-input" data-target="elb_med_entrap"> Entrapment at:</label><input type="text" id="elb_med_entrap" class="form-control d-inline-block w-auto py-0" disabled placeholder="loc"></div>
                <div class="finding-row"><span class="structure-label">Radial Nerve</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val toggle-input" data-target="elb_rad_entrap"> Entrapment at:</label><input type="text" id="elb_rad_entrap" class="form-control d-inline-block w-auto py-0" disabled placeholder="loc"></div>
                <div class="finding-row bg-light"><input type="text" class="form-control" id="elb_ant_other" placeholder="Others (Anterior)..."></div>

                <div class="section-label">Medial Elbow</div>
                <div class="finding-row"><span class="structure-label">Common wrist flexor tendon</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypervascularity"> Hypervascularity</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Calcification"> Calcification</label><div class="d-inline-block"><label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_med_cwft_tear"> Tear</label><div id="elb_med_cwft_tear" class="sub-options d-inline-block"><label class="me-1"><input type="radio" name="elb_med_cwft" value="partial thickness tear" checked> Partial</label><label class="me-1"><input type="radio" name="elb_med_cwft" value="full thickness tear"> Full</label></div></div></div>
                <div class="finding-row"><span class="structure-label">Ulnar collateral ligament</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Thickened"> Thickened</label><div class="d-inline-block"><label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_med_ucl_tear"> Tear</label><div id="elb_med_ucl_tear" class="sub-options d-inline-block"><label class="me-1"><input type="radio" name="elb_med_ucl" value="partial thickness tear" checked> Partial</label><label class="me-1"><input type="radio" name="elb_med_ucl" value="full thickness tear"> Full</label></div></div></div>
                <div class="finding-row bg-light"><input type="text" class="form-control" id="elb_med_other" placeholder="Others (Medial)..."></div>

                <div class="section-label">Posterior Elbow</div>
                <div class="finding-row"><span class="structure-label">Triceps tendon</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Calcification"> Calcification</label><div class="d-inline-block"><label class="me-2"><input type="checkbox" class="form-check-input val toggle-sub" data-target="elb_post_tri_tear"> Tear</label><div id="elb_post_tri_tear" class="sub-options d-inline-block"><label class="me-1"><input type="radio" name="elb_post_tri" value="partial thickness tear" checked> Partial</label><label class="me-1"><input type="radio" name="elb_post_tri" value="full thickness tear"> Full</label></div></div></div>
                <div class="finding-row"><span class="structure-label">Olecranon bursa</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Invisible"> Invisible</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Effusion"> Effusion</label></div>
                <div class="finding-row"><span class="structure-label">Ulnar nerve</span><label class="me-2"><input type="checkbox" class="form-check-input struct-intact val" value="Intact"> Intact</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Hypoechogenic"> Hypoechogenic</label><label class="me-2"><input type="checkbox" class="form-check-input val" value="Subluxation under dynamic study"> Subluxation</label><div class="d-inline-block bg-light p-1 border rounded"><label class="me-1 small fw-bold"><input type="checkbox" class="form-check-input val toggle-input" data-target="elb_csa_grp"> CSA:</label><span id="elb_csa_grp" style="opacity: 0.5;">R:<input type="number" id="csa_r" class="form-control d-inline-block w-auto py-0 px-1" disabled style="width:50px!important"> L:<input type="number" id="csa_l" class="form-control d-inline-block w-auto py-0 px-1" disabled style="width:50px!important"> mmÂ²</span></div></div>
                <div class="finding-row bg-light"><input type="text" class="form-control" id="elb_post_other" placeholder="Others (Posterior)..."></div>
            </div>
        </div>
        
        <div class="card shadow-sm border-success">
            <div class="card-header-custom bg-success">II. Elbow Impression</div>
            <div class="card-body">
                <textarea class="form-control" id="elb_impression_text" rows="4" placeholder="Type elbow impression here..."></textarea>
            </div>
        </div>
    </div>

    <div id="section_mass" class="content-section">
        <div class="card shadow-sm mb-3">
            <div class="card-header-custom">I. Mass Findings</div>
            <div class="card-body p-3">
                <div class="mb-3">
                    <label class="fw-bold d-block">1. Layer:</label>
                    <label class="me-3"><input type="radio" name="mass_layer" value="Subcutaneous" checked> Subcutaneous</label>
                    <label class="me-3"><input type="radio" name="mass_layer" value="Muscular"> Muscular</label>
                </div>
                <div class="mb-3">
                    <label class="fw-bold d-block">2. Size (mm):</label>
                    <input type="number" class="form-control d-inline-block input-mini" id="mass_size_l"> x <input type="number" class="form-control d-inline-block input-mini" id="mass_size_w"> x <input type="number" class="form-control d-inline-block input-mini" id="mass_size_h"> mm
                </div>
                <div class="mb-3">
                    <label class="fw-bold d-block">3. Echogenicity:</label>
                    <label class="me-3"><input type="checkbox" name="mass_echo" value="Heterogenous"> Heterogenous</label>
                    <label class="me-3"><input type="checkbox" name="mass_echo" value="Hyperechoic"> Hyperechoic</label>
                    <label class="me-3"><input type="checkbox" name="mass_echo" value="Hypoechoic"> Hypoechoic</label>
                    <label class="me-3"><input type="checkbox" name="mass_echo" value="Anechoic"> Anechoic</label>
                    <label class="me-3"><input type="checkbox" name="mass_echo" value="Cobblestone appearance"> Cobblestone appearance</label>
                </div>
                <div class="mb-3">
                    <label class="fw-bold d-block">4. Vascularity:</label>
                    <label class="me-3"><input type="radio" name="mass_vasc" value="increased vascularity"> Increased</label>
                    <label class="me-3"><input type="radio" name="mass_vasc" value="non-increased vascularity"> Non-increased</label>
                </div>
                <div class="mb-3">
                    <label class="fw-bold d-block">5. Compressibility:</label>
                    <label class="me-3"><input type="radio" name="mass_comp" value="compressible"> Compressible</label>
                    <label class="me-3"><input type="radio" name="mass_comp" value="non-compressible"> Non-compressible</label>
                </div>
                <div class="mb-3">
                    <label class="fw-bold d-block">6. Margin:</label>
                    <label class="me-3"><input type="radio" name="mass_margin" value="well-defined margin"> Well-defined</label>
                    <label class="me-3"><input type="radio" name="mass_margin" value="ill-defined margin"> Ill-defined</label>
                </div>
                <div class="mb-3">
                    <label class="fw-bold d-block">7. Location:</label>
                    <input type="text" class="form-control" id="mass_find_loc" placeholder="e.g. anterior thigh">
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-success">
            <div class="card-header-custom bg-success">II. Mass Impression</div>
            <div class="card-body">
                <div class="mb-2">
                    <label class="fw-bold d-block">Diagnosis:</label>
                    <div class="d-block mt-1"><label class="me-2"><input type="checkbox" class="mass-imp toggle-sub" data-target="mass_cellulitis"> Cellulitis</label><span id="mass_cellulitis" class="sub-options d-inline-block ms-0 mt-0 py-0"><label><input type="checkbox" class="mass-imp-detail" value="with abscess formation"> with abscess formation</label></span></div>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Hematoma"> Hematoma</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Lipoma"> Lipoma</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Ganglion cyst"> Ganglion cyst</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Epidermoid cyst"> Epidermoid cyst</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Tophus"> Tophus</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Neurofibroma"> Neurofibroma</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Schwannoma"> Schwannoma</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Desmoid tumor"> Desmoid tumor</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Hemangioma"> Hemangioma</label>
                    <label class="me-2 d-block"><input type="checkbox" class="mass-imp" value="Etiology undetermined, suggest tissue proof"> Etiology undetermined, suggest tissue proof</label>
                </div>
                <div class="mt-2">
                    <label class="fw-bold">Others:</label>
                    <input type="text" class="form-control" id="mass_other_text" placeholder="Other diagnosis...">
                </div>
            </div>
        </div>
    </div>
    
    <div id="section_wrist" class="content-section"><div class="alert alert-secondary">Wrist section placeholder.</div></div>
    <div id="section_knee" class="content-section"><div class="alert alert-secondary">Knee section placeholder.</div></div>
    <div id="section_ankle" class="content-section"><div class="alert alert-secondary">Ankle section placeholder.</div></div>

    <button class="btn btn-primary w-100 py-3 mt-4 fw-bold fs-5" onclick="generateReport()">Generate Report</button>
    
    <div class="mt-4">
        <h5>Report Preview:</h5>
        <div id="output" class="report-box shadow-sm"></div>
    </div>
</div>

<script>
    // --- UI Logic ---
    function switchPart(partId) {
        document.querySelectorAll('.part-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
        document.getElementById('section_' + partId).classList.add('active');
    }

    document.querySelectorAll('.toggle-sub').forEach(cb => {
        cb.addEventListener('change', function() {
            const target = document.getElementById(this.dataset.target);
            if(target) target.style.display = this.checked ? 'inline-block' : 'none';
        });
    });

    document.querySelectorAll('.toggle-input').forEach(cb => {
        cb.addEventListener('change', function() {
            const target = document.getElementById(this.dataset.target);
            if(target) {
                if(this.dataset.target.includes('grp')) {
                    target.style.opacity = this.checked ? '1' : '0.5';
                    target.querySelectorAll('input').forEach(i => i.disabled = !this.checked);
                } else {
                    target.disabled = !this.checked;
                    if(!this.checked) target.value = '';
                }
            }
        });
    });

    // Auto-uncheck Logic for "Intact"
    document.querySelectorAll('.struct-intact').forEach(intact => {
        intact.addEventListener('change', function() {
            if(this.checked) {
                let row = this.closest('.finding-row');
                row.querySelectorAll('input[type="checkbox"]:not(.struct-intact)').forEach(cb => {
                    cb.checked = false;
                    cb.dispatchEvent(new Event('change'));
                });
            }
        });
    });
    
    document.querySelectorAll('.finding-row input[type="checkbox"]:not(.struct-intact)').forEach(abnormal => {
        abnormal.addEventListener('change', function() {
            if(this.checked) {
                let row = this.closest('.finding-row');
                let intact = row.querySelector('.struct-intact');
                if(intact) intact.checked = false;
            }
        });
    });

    // --- Generation Logic ---
    function generateReport() {
        const side = document.querySelector('input[name="side"]:checked').value;
        const activePart = document.querySelector('.content-section.active').id;
        let finalReport = "";

        if (activePart === 'section_shoulder') {
            finalReport = `This ultrasonography study of ${side} shoulder showed:\n`;
            finalReport += generateShoulderFindings();
            finalReport += "\n" + generateShoulderImpression(side);
        } else if (activePart === 'section_elbow') {
            finalReport = generateElbowReport(side);
        } else if (activePart === 'section_mass') {
            finalReport = generateMassReport();
        } else {
            finalReport = `[${activePart}] Report under construction.`;
        }
        
        document.getElementById('output').innerText = finalReport;
    }

    // --- Shoulder Logic ---
    function generateShoulderFindings() {
        let text = "Findings:\n";
        const container = document.getElementById('section_shoulder');
        const intactIds = container.querySelectorAll('.struct-intact:checked');
        const anyPathology = container.querySelectorAll('.val:checked').length > 0;
        
        if (intactIds.length === 6 && !anyPathology) {
             return text + `intact biceps LH tendon, AC joint, subscapularis, supraspinatus tendon, infraspinatus and posterior labrum\n`;
        }

        let findingsList = [];
        container.querySelectorAll('.finding-row').forEach(row => {
            const label = row.querySelector('.structure-label').innerText;
            let rowVals = [];
            if (row.querySelector('.struct-intact') && row.querySelector('.struct-intact').checked) rowVals.push("intact");
            
            row.querySelectorAll('.val:checked').forEach(cb => {
                if(cb.classList.contains('toggle-sub') || cb.classList.contains('toggle-input')) return;
                rowVals.push(cb.value);
            });

            // Sub-logic handling (Shoulder)
            if (row.querySelector('[data-target="sub_bic_tear"]:checked')) {
                let tearType = document.querySelector('input[name="bic_tear"]:checked').value;
                rowVals.push("tear (" + tearType + ")");
            }
            if (row.querySelector('[data-target="sub_subscap_tear"]:checked')) {
                let tearType = document.querySelector('input[name="subscap_tear"]:checked').value;
                let extra = document.querySelector('#sub_subscap_tear .val-sub-extra:checked');
                if(extra) tearType += ", Hypervascularity";
                rowVals.push("tear (" + tearType + ")");
            }
            if (row.querySelector('[data-target="sub_subscap_calc"]:checked')) {
                let types = Array.from(document.querySelectorAll('#sub_subscap_calc .val-sub:checked')).map(c => c.value);
                let extra = document.querySelector('#sub_subscap_calc .val-sub-extra:checked');
                let desc = "calcific deposit along the subscapularis tendon fibers with partial shadowing";
                if(types.length > 0) desc += ` (${types.join(', ')})`;
                if(extra) desc += " with Hypervascularity";
                rowVals.push(desc);
            }
            if (row.querySelector('[data-target="sub_supra_tear"]:checked')) {
                let subDiv = document.getElementById('sub_supra_tear');
                let types = Array.from(subDiv.querySelectorAll('.val-sub:checked')).map(c => c.value);
                let feats = Array.from(subDiv.querySelectorAll('.val-sub-feat:checked')).map(c => "with " + c.value);
                let locs = Array.from(subDiv.querySelectorAll('.val-sub-loc:checked')).map(c => c.value);
                let str = "tear";
                if(types.length > 0) str += ` (${types.join(', ')})`;
                if(feats.length > 0) str += ` ${feats.join(', ')}`;
                if(locs.length > 0) str += ` at ${locs.join('/')} part`;
                rowVals.push(str);
            }
            if (row.querySelector('[data-target="sub_supra_calc"]:checked')) {
                let types = Array.from(document.querySelectorAll('#sub_supra_calc .val-sub:checked')).map(c => c.value);
                let extra = document.querySelector('#sub_supra_calc .val-sub-extra:checked');
                let desc = "calcific deposit along the supraspinatus tendon fibers with partial shadowing";
                if(types.length > 0) desc += ` (${types.join(', ')})`;
                if(extra) desc += " with Hypervascularity";
                rowVals.push(desc);
            }
            if (row.querySelector('[data-target="sub_infra_tear"]:checked')) {
                let tearType = document.querySelector('input[name="infra_tear"]:checked').value;
                let extra = document.querySelector('#sub_infra_tear .val-sub-extra:checked');
                if(extra) tearType += ", Hypervascularity";
                rowVals.push("tear (" + tearType + ")");
            }
            if (row.querySelector('[data-target="sub_infra_calc"]:checked')) {
                let types = Array.from(document.querySelectorAll('#sub_infra_calc .val-sub:checked')).map(c => c.value);
                let extra = document.querySelector('#sub_infra_calc .val-sub-extra:checked');
                let desc = "calcific deposit along the infraspinatus tendon fibers with partial shadowing";
                if(types.length > 0) desc += ` (${types.join(', ')})`;
                if(extra) desc += " with Hypervascularity";
                rowVals.push(desc);
            }
            if(label === "Others") {
                 let freeText = document.getElementById('sh_other_text').value;
                 if(freeText) rowVals.push(freeText);
            }

            if(rowVals.length > 0) findingsList.push(`${label}: ${rowVals.join(', ')}`);
        });

        if(findingsList.length > 0) text += findingsList.join('\n') + "\n";
        return text;
    }

    function generateShoulderImpression(side) {
        let imps = [];
        if (document.querySelector('[data-target="imp_sub_bic"]:checked')) {
            let details = Array.from(document.querySelectorAll('#imp_sub_bic .imp-val:checked')).map(c => c.value);
            if(details.length > 0) imps.push(`${side} Biceps brachialis long head: ${details.join(', ')}`);
        }
        if (document.querySelector('[data-target="imp_sub_supra"]:checked')) {
            let vals = Array.from(document.querySelectorAll('#imp_sub_supra .imp-val:checked')).map(c => c.value);
            let details = Array.from(document.querySelectorAll('#imp_sub_supra .imp-val-detail:checked')).map(c => c.value);
            let str = `${side} Supraspinatus: ${vals.join(', ')}`;
            if(details.length > 0) str += ` (${details.join(', ')})`;
            if(vals.length > 0) imps.push(str);
        }
        if (document.querySelector('[data-target="imp_sub_subscap"]:checked')) {
            let vals = Array.from(document.querySelectorAll('#imp_sub_subscap .imp-val:checked')).map(c => c.value);
            if(vals.length > 0) imps.push(`${side} Subscapularis: ${vals.join(', ')}`);
        }
        if (document.querySelector('[data-target="imp_sub_infra"]:checked')) {
            let vals = Array.from(document.querySelectorAll('#imp_sub_infra .imp-val:checked')).map(c => c.value);
            if(vals.length > 0) imps.push(`${side} Infraspinatus: ${vals.join(', ')}`);
        }
        document.querySelectorAll('.imp-check:checked').forEach(cb => imps.push(`${side} ${cb.value}`));
        let otherImp = document.getElementById('imp_other_text').value;
        if(otherImp) imps.push(`${side} ${otherImp}`);

        if(imps.length === 0) return "";
        let text = `Impression:\n`;
        imps.forEach(imp => text += `* ${imp}\n`);
        text += "Please correlate with clinical presentation.";
        return text;
    }

    // --- Elbow Logic ---
    function generateElbowReport(side) {
        let text = `This ultrasonography study of ${side} elbow showed:\nFindings:\n`;
        const container = document.getElementById('section_elbow');
        
        container.querySelectorAll('.finding-row').forEach(row => {
            if(row.querySelector('input[type="text"]')) {
                 let otherText = row.querySelector('input[type="text"]').value;
                 if(otherText) text += `- Others: ${otherText}\n`;
            } else {
                const label = row.querySelector('.structure-label').innerText;
                let rowVals = [];
                if (row.querySelector('.struct-intact') && row.querySelector('.struct-intact').checked) rowVals.push("intact");

                row.querySelectorAll('.val:checked').forEach(cb => {
                    if(cb.classList.contains('toggle-sub') || cb.classList.contains('toggle-input')) return;
                    rowVals.push(cb.value);
                });
                if (row.querySelector('.toggle-sub:checked') && row.querySelector('input[type="radio"]')) {
                    rowVals.push("tear (" + row.querySelector('input[type="radio"]:checked').value + ")");
                }
                if (row.querySelector('.toggle-input:checked') && row.querySelector('input[type="text"]')) {
                    rowVals.push(`Entrapment at ${row.querySelector('input[type="text"]').value || '?'}`);
                }
                if (row.querySelector('.toggle-input:checked') && row.querySelector('#csa_r')) {
                    let r = document.getElementById('csa_r').value || '-';
                    let l = document.getElementById('csa_l').value || '-';
                    rowVals.push(`CSA at cubital tunnel (R: ${r}, L: ${l} mmÂ²)`);
                }
                if(rowVals.length > 0) text += `- ${label}: ${rowVals.join(', ')}\n`;
            }
        });
        
        let impText = document.getElementById('elb_impression_text').value;
        if(impText) text += `\nImpression:\n${impText}\n`;
        
        text += "\nPlease correlate with clinical presentation.";
        return text;
    }

    // --- Mass Logic ---
    function generateMassReport() {
        let layer = document.querySelector('input[name="mass_layer"]:checked').value;
        let text = `This ultrasonography study of ${layer.toLowerCase()} mass showed:\nFindings:\n`;
        
        let sizeL = document.getElementById('mass_size_l').value;
        let sizeW = document.getElementById('mass_size_w').value;
        let sizeH = document.getElementById('mass_size_h').value;
        if(sizeL || sizeW || sizeH) text += `- Size: ${sizeL}x${sizeW}x${sizeH} mm\n`;
        
        let echoList = Array.from(document.querySelectorAll('input[name="mass_echo"]:checked')).map(cb => cb.value);
        if(echoList.length > 0) text += `- Echogenicity: ${echoList.join(', ')}\n`;

        let vasc = document.querySelector('input[name="mass_vasc"]:checked');
        if(vasc) text += `- Vascularity: ${vasc.value}\n`;

        let comp = document.querySelector('input[name="mass_comp"]:checked');
        if(comp) text += `- Compressibility: ${comp.value}\n`;

        let margin = document.querySelector('input[name="mass_margin"]:checked');
        if(margin) text += `- Margin: ${margin.value}\n`;

        let locFind = document.getElementById('mass_find_loc').value;
        if(locFind) text += `- Location: ${locFind}\n`;

        text += `\nImpression:\n`;
        let imps = [];
        
        document.querySelectorAll('.mass-imp:checked').forEach(cb => {
            if(cb.classList.contains('toggle-sub')) {
                let txt = "Cellulitis";
                let detail = document.querySelector('.mass-imp-detail:checked');
                if(detail) txt += " " + detail.value;
                imps.push(txt);
            } else {
                imps.push(cb.value);
            }
        });
        
        let other = document.getElementById('mass_other_text').value;
        if(other) imps.push(other);

        if(imps.length > 0) {
            imps.forEach(diag => {
                let line = `${layer.toLowerCase()} ${diag}`; 
                if(locFind) line += ` at ${locFind}`;
                text += `* ${line}\n`;
            });
        } else if(locFind) {
             text += `* ${layer.toLowerCase()} mass at ${locFind}\n`;
        }
        
        text += "Please correlate with clinical presentation.";
        return text;
    }
</script>

</body>
</html>
